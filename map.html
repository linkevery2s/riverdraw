<!DOCTYPE HTML>
<html lang="ja">

<head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# article: http://ogp.me/ns/article#">
    <meta charset='UTF-8' name='viewport'
        content='width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no'>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>

    <style>
        html,
        body,#map {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
        }


    </style>
    <script type="module">

        let lat; let lon; let zoom; let center; let number; let data;

        const url_hash = location.hash;
        let hash_last;

        if (url_hash === "") {
            lat = 37.300;
            lon = 137.800;
            zoom = 6;
            center = [lat, lon];
            data = [];

        } else {
            console.log(url_hash);

            hash_last = url_hash.split("!");

            lat = Number(hash_last[1].split("/")[1]);
            lon = Number(hash_last[1].split("/")[0]);
            number = Number(hash_last[1].split("/")[2]);
            zoom = 8;

            center = [lat, lon];

            const res = await fetch('./data/' + number + '.geojson');
            data = await res.json();

        }

        const tiri = L.tileLayer('https://cyberjapandata.gsi.go.jp/xyz/blank/{z}/{x}/{y}.png', {
            //attribution: '&copy; <a href="http://maps.gsi.go.jp/development/ichiran.html" target="_blank">地理院タイル</a>'
        });


        // const overlayMaps = { "洪水浸水想定区域（想定最大規模）": soutei };



        const map = L.map('map', {
            center: center,
            zoom: zoom,
            maxZoom: 15,
            layers: tiri,
            zoomControl: false
        });

        let geo_k = (feature, layer) => {
            let popup;
            if (feature.properties && feature.properties.W05_004) {
                popup = feature.properties.W05_004;
            }

            layer.bindPopup(popup);

        }

        const pref = L.geoJson(data, { onEachFeature: geo_k });

        map.addLayer(pref);

    </script>
    <title>map</title>

</head>

<body>

    <div id="map"></div>

</body>

</html>